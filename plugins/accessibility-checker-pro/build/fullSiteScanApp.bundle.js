/*! For license information please see fullSiteScanApp.bundle.js.LICENSE.txt */
(()=>{"use strict";let e=!1;"undefined"!=typeof edacpFullSiteScanApp&&(e="1"===edacpFullSiteScanApp.debug);const t=e,n=e,i=e=>{t&&console.info(e)},a=e=>{n&&(window.location.href!==window.top.location.href&&console.debug("DEBUG [ "+window.location.href+" ]"),"object"!=typeof e?console.debug("DEBUG: "+e):console.debug(e))};var o,s=function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},c=function(){function e(e){this.options=e,this.listeners={}}return e.prototype.on=function(e,t){var n=this.listeners[e]||[];this.listeners[e]=n.concat([t])},e.prototype.triggerEvent=function(e,t){var n=this;(this.listeners[e]||[]).forEach((function(e){return e({target:n,event:t})}))},e}();!function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove"}(o||(o={}));var r,p=function(){function e(){this.notifications=[]}return e.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,o.Add,this.notifications)},e.prototype.splice=function(e,t){var n=this.notifications.splice(e,t)[0];return this.updateFn(n,o.Remove,this.notifications),n},e.prototype.indexOf=function(e){return this.notifications.indexOf(e)},e.prototype.onUpdate=function(e){this.updateFn=e},e}();!function(e){e.Dismiss="dismiss",e.Click="click"}(r||(r={}));var l={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},d=function(){function e(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),t=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(t),document.body.appendChild(e),this.container=t,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return e.prototype.on=function(e,t){var n;this.events=s(s({},this.events),((n={})[e]=t,n))},e.prototype.update=function(e,t){t===o.Add?this.addNotification(e):t===o.Remove&&this.removeNotification(e)},e.prototype.removeNotification=function(e){var t,n,i=this,a=this._popRenderedNotification(e);a&&((t=a.node).classList.add("notyf__toast--disappear"),t.addEventListener(this.animationEndEventName,n=function(e){e.target===t&&(t.removeEventListener(i.animationEndEventName,n),i.container.removeChild(t))}))},e.prototype.addNotification=function(e){var t=this._renderNotification(e);this.notifications.push({notification:e,node:t}),this._announce(e.options.message||"Notification")},e.prototype._renderNotification=function(e){var t,n=this._buildNotificationCard(e),i=e.options.className;return i&&(t=n.classList).add.apply(t,i.split(" ")),this.container.appendChild(n),n},e.prototype._popRenderedNotification=function(e){for(var t=-1,n=0;n<this.notifications.length&&t<0;n++)this.notifications[n].notification===e&&(t=n);if(-1!==t)return this.notifications.splice(t,1)[0]},e.prototype.getXPosition=function(e){var t;return(null===(t=null==e?void 0:e.position)||void 0===t?void 0:t.x)||"right"},e.prototype.getYPosition=function(e){var t;return(null===(t=null==e?void 0:e.position)||void 0===t?void 0:t.y)||"bottom"},e.prototype.adjustContainerAlignment=function(e){var t=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],n=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",n),i.setProperty("align-items",t)},e.prototype._buildNotificationCard=function(e){var t=this,n=e.options,i=n.icon;this.adjustContainerAlignment(n);var a=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),s=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),c=this._createHTMLElement({tagName:"div",className:"notyf__message"});c.innerHTML=n.message||"";var p=n.background||n.backgroundColor;if(i){var l=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if(("string"==typeof i||i instanceof String)&&(l.innerHTML=new String(i).valueOf()),"object"==typeof i){var d=i.tagName,u=void 0===d?"i":d,h=i.className,f=i.text,m=i.color,y=void 0===m?p:m,g=this._createHTMLElement({tagName:u,className:h,text:f});y&&(g.style.color=y),l.appendChild(g)}s.appendChild(l)}if(s.appendChild(c),a.appendChild(s),p&&(n.ripple?(o.style.background=p,a.appendChild(o)):a.style.background=p),n.dismissible){var S=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),v=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});S.appendChild(v),s.appendChild(S),a.classList.add("notyf__toast--dismissible"),v.addEventListener("click",(function(n){var i,a;null===(a=(i=t.events)[r.Dismiss])||void 0===a||a.call(i,{target:e,event:n}),n.stopPropagation()}))}a.addEventListener("click",(function(n){var i,a;return null===(a=(i=t.events)[r.Click])||void 0===a?void 0:a.call(i,{target:e,event:n})}));var b="top"===this.getYPosition(n)?"upper":"lower";return a.classList.add("notyf__toast--"+b),a},e.prototype._createHTMLElement=function(e){var t=e.tagName,n=e.className,i=e.text,a=document.createElement(t);return n&&(a.className=n),a.textContent=i||null,a},e.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},e.prototype._announce=function(e){var t=this;this.a11yContainer.textContent="",setTimeout((function(){t.a11yContainer.textContent=e}),100)},e.prototype._getAnimationEndEventName=function(){var e,t=document.createElement("_fake"),n={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"};for(e in n)if(void 0!==t.style[e])return n[e];return"animationend"},e}(),u=function(){function e(e){var t=this;this.dismiss=this._removeNotification,this.notifications=new p,this.view=new d;var n=this.registerTypes(e);this.options=s(s({},l),e),this.options.types=n,this.notifications.onUpdate((function(e,n){return t.view.update(e,n)})),this.view.on(r.Dismiss,(function(e){var n=e.target,i=e.event;t._removeNotification(n),n.triggerEvent(r.Dismiss,i)})),this.view.on(r.Click,(function(e){var t=e.target,n=e.event;return t.triggerEvent(r.Click,n)}))}return e.prototype.error=function(e){var t=this.normalizeOptions("error",e);return this.open(t)},e.prototype.success=function(e){var t=this.normalizeOptions("success",e);return this.open(t)},e.prototype.open=function(e){var t=this.options.types.find((function(t){return t.type===e.type}))||{},n=s(s({},t),e);this.assignProps(["ripple","position","dismissible"],n);var i=new c(n);return this._pushNotification(i),i},e.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},e.prototype.assignProps=function(e,t){var n=this;e.forEach((function(e){t[e]=null==t[e]?n.options[e]:t[e]}))},e.prototype._pushNotification=function(e){var t=this;this.notifications.push(e);var n=void 0!==e.options.duration?e.options.duration:this.options.duration;n&&setTimeout((function(){return t._removeNotification(e)}),n)},e.prototype._removeNotification=function(e){var t=this.notifications.indexOf(e);-1!==t&&this.notifications.splice(t,1)},e.prototype.normalizeOptions=function(e,t){var n={type:e};return"string"==typeof t?n.message=t:"object"==typeof t&&(n=s(s({},n),t)),n},e.prototype.registerTypes=function(e){var t=(e&&e.types||[]).slice();return l.types.map((function(e){var n=-1;t.forEach((function(t,i){t.type===e.type&&(n=i)}));var i=-1!==n?t.splice(n,1)[0]:{};return s(s({},e),i)})).concat(t)},e}();const h=e=>{const t=Object.assign({},{msg:"",type:"warning",url:!1,label:"",closeOthers:!0},e);if(void 0!==window.wp&&void 0!==window.wp.data&&void 0!==window.wp.data.dispatch){const e={isDismissible:!0};let n=t.msg;t.url?(e.actions=[{url:t.url,label:t.label}],n=n.replace("{link}","follow the link below")):n=n.replace("{link}",""),t.closeOthers&&document.querySelectorAll(".components-notice").forEach((e=>{e.style.display="none"})),setTimeout((function(){wp.data.dispatch("core/notices").createNotice(t.type,n,e)}),10)}else{const e=document.createElement("link");e.href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css",e.type="text/css",e.rel="stylesheet",e.media="screen,print",document.getElementsByTagName("head")[0].appendChild(e);let n=t.msg;n=t.url?n.replace("{link}",'<a href="'+t.url+'" target="_blank" arial-label="'+t.label+'">'+t.label+"</a>"):n.replace("{link}","");const i=new u({position:{x:"right",y:"top"},ripple:!1,types:[{type:"success",background:"#193EEE",duration:2e3,dismissible:!0,icon:!1},{type:"warning",background:"#454545",duration:4e3,dismissible:!0,icon:!1},{type:"error",background:"#AD1414",duration:0,dismissible:!0,icon:!1}]});t.closeOthers&&i.dismissAll(),i.open({type:t.type,message:n})}},f=edacpFullSiteScanApp.edacpApiUrl,m=edacpFullSiteScanApp.restNonce;let y,g,S,v,b,w,_,A,k,E,N,F;const T="Checking the full site may take some time to complete. This page must be open for the scan to run.",C={new:{title:"Full Site Accessibility Check",status:"",lead:""},canceled:{title:"Full Site Accessibility Check",status:"",lead:""},queued:{title:"Check Queued",status:"",lead:"The check has been queued and will begin shortly. "+T},"php-scan-running":{title:"Check In Progress",lead:"The check is in progress (pass 1 of 2). "+T},"js-scan-running":{title:"Check In Progress",lead:"The check is in progress (pass 2 of 2). "+T},completed:{title:"Check Complete!",lead:""}};let j=!1,L=!1,P=0,O=0,M=0;const I=async(e="",t={})=>(await fetch(e,{headers:{"X-WP-Nonce":m,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)})).json(),x=(e,t="block")=>{e&&(e.style.display=t)},q=e=>{e&&(e.style.display="none")},R=(e,t)=>{e&&(e.innerHTML=t)},H=()=>{if(window.performance&&window.performance.memory){const e=window.performance.memory,t=parseInt(e.usedJSHeapSize/1048576),n=parseInt(e.totalJSHeapSize/1048576),i=parseInt(e.jsHeapSizeLimit/1048576);t>P&&(P=t),n>O&&(O=n),i>M&&(M=i);const o=t+"/"+P+" | "+n+"/"+O+" | "+i+"/"+M;"undefined"!=typeof edacpFullSiteScanApp&&edacpFullSiteScanApp.scanStats?.js?.state&&"js-scan-running"===edacpFullSiteScanApp.scanStats.js.state&&edacpFullSiteScanApp.scanStats.js.complete/5===parseInt(edacpFullSiteScanApp.scanStats.js.complete/5)&&a("Memory: "+o),n/i>=.8&&window.location.reload(!0)}(async(e="")=>{try{const t=await fetch(e,{headers:{"X-WP-Nonce":m,"Content-Type":"application/json"},method:"GET"});return await t.json()}catch(e){return{}}})(f+"/scan-stats").then((e=>{"rest_no_route"!==e.code?void 0!==e.data&&("undefined"==typeof edacpFullSiteScanApp&&(edacpFullSiteScanApp={}),edacpFullSiteScanApp.scanStats=e.data.scanStats,D(),setTimeout((()=>{H()}),1e3)):(a("rest route scan-stats is not setup."),h({msg:"Whoops! It looks like there was a problem connecting to the Rest Api. Please refresh the page to try again.",type:"error"}))})).catch((()=>{a("rest route scan-stats is not setup."),h({msg:"Whoops! It looks like there was a problem connecting to the Rest Api. Please refresh the page to try again.",type:"error"})}))},U=()=>{y=document.querySelector(".edacp-scan-start-btn"),g=document.querySelector(".edacp-scan-reset-btn"),S=document.querySelector(".edacp-scan-stop-pass1-btn"),v=document.querySelector(".edacp-scan-stop-pass2-btn"),k=document.querySelector(".edacp-scan-progress-title"),E=document.querySelector(".edacp-scan-progress-lead"),N=document.querySelector(".edacp-scan-progress-bar"),F=document.querySelector(".edacp-scan-progress-count"),b=document.querySelector(".edacp-scan-progress-bar-complete"),w=document.querySelector(".edacp-scan-progress-bar-percentage"),_=document.querySelector(".edacp-scan-progress-complete"),A=document.querySelector(".edacp-scan-progress-total"),x(y,"inline-block"),q(g),q(S),q(v),x(k),x(E),q(N),q(F),y&&y.addEventListener("click",(function(){this.disabled=!0,I(edacpFullSiteScanApp.edacpApiUrl+"/start-new-scan",{}).finally((()=>{window.location.reload()}))})),g&&g.addEventListener("click",(function(){this.disabled=!0,I(edacpFullSiteScanApp.edacpApiUrl+"/cancel-current-scan").then((()=>{window.location.reload()}))})),S&&S.addEventListener("click",(function(){I(edacpFullSiteScanApp.edacpApiUrl+"/cancel-current-php-scan",{}).then((e=>{e.canceled&&S.hide()}))})),v&&v.addEventListener("click",(function(){I(edacpFullSiteScanApp.edacpApiUrl+"/cancel-current-scan",{}).then((e=>{e.canceled&&v.hide()}))}))},D=()=>{const e=function(e,t=!0){b.style.transition=t?"width 1s":"width 0s",b.style.width=e+"%",R(w,e+"%")},t=function(e,t,n){let i=0;n>0&&(i=Math.floor((e+t)/n*100)),b.style.transition="width 1s",b.style.width=i+"%",R(w,i+"%"),R(_,e)};if("undefined"==typeof edacpFullSiteScanApp||void 0===edacpFullSiteScanApp.scanStats||void 0===edacpFullSiteScanApp.scanStats.php||void 0===edacpFullSiteScanApp.scanStats.php.state)return;let n;if("js-scan-running"===edacpFullSiteScanApp.scanStats.php.state||"js-scan-complete"===edacpFullSiteScanApp.scanStats.php.state){if(n=edacpFullSiteScanApp.scanStats.js,void 0===n.state)return}else n=edacpFullSiteScanApp.scanStats.php;switch(n.state){case"new":j=!1,L=!1,q(N),q(F),q(S),q(v),x(g,"inline-block"),R(k,C.new.title),R(E,C.new.lead);break;case"canceled":j=!1,L=!1,q(N),q(F),q(S),q(v),q(g),R(k,C.canceled.title),R(E,C.canceled.lead);break;case"queued":q(N),q(F),q(S),x(v,"inline-block"),q(g),R(k,C.queued.title),R(E,C.queued.lead),e(0,!1);break;case"php-scan-running":x(N),x(F),x(S,"inline-block"),q(v),q(g),R(k,C["php-scan-running"].title),R(E,C["php-scan-running"].lead),j?t(n.complete,n.failed,n.total):(j=!0,e(0,!1));break;case"php-scan-complete":x(N),x(F),q(S),q(v),q(g),e(100);break;case"js-scan-running":x(N),x(F),q(S),x(v,"inline-block"),q(g),R(k,C["js-scan-running"].title),R(E,C["js-scan-running"].lead),L?t(n.complete,n.failed,n.total):(L=!0,e(0,!1));break;case"js-scan-complete":e(100),R(E,"Scan completed on "+edacpFullSiteScanApp.scanStats.php.date_formatted+". "+n.complete+" pages were checked successfully and "+n.failed+" pages failed."),x(N),x(F),q(S),q(v),q(g);break;case"completed":e(100),R(k,C.completed.title),R(E,"Scan completed on "+edacpFullSiteScanApp.scanStats.php.date_formatted+". "+n.complete+" pages were checked successfully and "+n.failed+" pages failed."),q(N),x(F),x(g,"inline-block"),q(S),q(v);break;default:q(N),q(F),q(S),q(v),x(g,"inline-block")}R(_,n.complete),R(A,n.total)},W=edacpFullSiteScanApp.edacpApiUrl,X=edacpFullSiteScanApp.restNonce,G=edacpFullSiteScanApp.edacApiUrl,z=edacpFullSiteScanApp.edacBaseUrl;let B=0;const Y=(e,t,n=!1)=>{a("Saving: "+e+": started"),(async(e="",t={})=>{try{const n=await fetch(e,{headers:{"X-WP-Nonce":X,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});return await n.json()}catch(t){return i("Error during POST request to "+e),a(t),{}}})(G+"/post-scan-results/"+e,{violations:t,isSkipped:n}).then((t=>{t.success?(i("Saved: "+e),K()):(i("Saving: "+e+": failed."),h({msg:"Whoops! It looks like there was a problem saving a page status. Please reload the page to try again.",type:"error"}))})).catch((t=>{i("Saving: "+e+": error"),a(t),h({msg:"Whoops! It looks like there was a problem saving a page status. Please reload the page to try again.",type:"error"})}))},J=e=>{i("Skipping: "+e+"."),Y(e,[],!0)},Q=e=>{J(e)},K=((e,t)=>{let n;return function(...t){n&&clearTimeout(n);const i=this;n=setTimeout((()=>{e.apply(i,t)}),250)}})((()=>{"undefined"==typeof edacpFullSiteScanApp||void 0===edacpFullSiteScanApp.scanStats||void 0===edacpFullSiteScanApp.scanStats.js||void 0===edacpFullSiteScanApp.scanStats.js.state||"js-scan-running"!==edacpFullSiteScanApp.scanStats.js.state||"js-scan-running"===edacpFullSiteScanApp.scanStats.js.state&&0===edacpFullSiteScanApp.scanStats.js.pending?setTimeout((function(){K()}),1e3):(async(e="")=>{try{const t=await fetch(e,{headers:{"X-WP-Nonce":X,"Content-Type":"application/json"},method:"GET"});return await t.json()}catch(t){return i("Error during GET request to "+e),a(t),{}}})(W+"/scheduled-scan-url").then((e=>{if("rest_no_route"!==e.code){if(void 0!==e.data){if("undefined"==typeof edacpFullSiteScanApp&&(edacpFullSiteScanApp={}),edacpFullSiteScanApp.scanStats=e.data.scanStats,"js-scan-running"!==edacpFullSiteScanApp.scanStats.js.state)return;if(void 0!==e.data.scanUrl){const t=e.data.liveUrl,n=e.data.scanUrl,o=e.data.postId;B++,B>=100&&window.location.reload(!0),(async(e="")=>{try{return(await fetch(e,{method:"GET",redirect:"error"})).status}catch(t){throw i("Error during GET request to "+e),a(t),t}})(t).then((e=>{i("Check post: "+o),i(t),200===e?((e,t)=>{((e,t)=>{const n="iframe_"+(new Date).getTime()+"_"+Math.floor(1e3*Math.random()),i=document.createElement("iframe");i.setAttribute("id",n),i.setAttribute("src",e),i.style.width=window.screen.width+"px",i.style.height=window.screen.height+"px",i.style.position="absolute",i.style.left="-"+window.screen.width+"px",document.body.append(i),i.addEventListener("load",(()=>{a("iframe loaded: "+t);const e=i.contentDocument||i.contentWindow.document,o=e.querySelector("body");if(o.setAttribute("data-iframe-id",n),o.setAttribute("data-iframe-event-name","edacp_scan_complete"),o.setAttribute("data-iframe-post-id",t),e){const t=e.createElement("script");t.text="\n\t\t\t\tconsole.log = function(){};\n\t\t\t\tconsole.error = function(){};\n\t\t\t\tconsole.debug = function(){};\n\t\t\t\tconsole.info = function(){};\n\t\t\t\twindow.onerror = function(){ return true; };\n\t\t\t\t",e.head.appendChild(t);const i=e.createElement("script");i.src=z+"/build/pageScanner.bundle.js?uid="+n,e.head.appendChild(i)}})),i.addEventListener("error",(function(){a("ERROR loading iframe:"+t),i.remove(),J(t)}))})(t,e)})(o,n):(a("getHttpStatusCode returned: "+e),Q(o))})).catch((e=>{i("*** Skipping post "+o+":REDIR OR ERROR"),a(e),Q(o)}))}}}else a("rest route scheduled-scan-url is not setup."),h({msg:"Whoops! It looks like there was a problem connecting to the Rest Api. Please refresh the page to try again.",type:"error"})})).catch((e=>{a("Getting new scheduled-scan-url: error"),a(e),h({msg:"Whoops! It looks like there was a problem connecting to the Rest Api. Please refresh the page to try again.",type:"error"})}))}));window.addEventListener("DOMContentLoaded",(()=>{"full-site-scan"===edacpFullSiteScanApp.mode&&((()=>{const e=e=>{const t=e.detail.postId,n=e.detail.violations,i=e.detail.iframeId,o=e.detail.failed;e.detail.errorMsgs&&(a("**** Scan complete, ERROR."),a(e.detail.errorMsgs)),a("Scan complete, flagged issues:"),a(n);const s=document.getElementById(i);if(s){const e=setTimeout((function(){s.remove(),clearTimeout(e)}),1e3)}o?J(t):Y(t,n)};K(),top.addEventListener("edacp_scan_complete",e),window.addEventListener("beforeunload",(function(){top.removeEventListener("edacp_scan_complete",e)}))})(),U(),H(),setTimeout((function(){window.location.reload(!0)}),6e5))}))})();